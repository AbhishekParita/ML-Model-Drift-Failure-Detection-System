{% extends "base.html" %}

{% block title %}Overview - ML Monitoring Dashboard{% endblock %}

{% block extra_style %}
<style>
    .status-banner {
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
        border: 2px solid;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
    }
    .status-banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 6px;
        height: 100%;
        background: currentColor;
    }
    .status-banner-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .status-banner-icon {
        font-size: 28px;
    }
    .status-banner-message {
        font-size: 15px;
        opacity: 0.95;
        margin-left: 40px;
    }
    .status-banner.healthy {
        background: #1E293B;
        border-color: #10B981;
        color: #10B981;
    }
    .status-banner.warning {
        background: #1E293B;
        border-color: #F59E0B;
        color: #F59E0B;
    }
    .status-banner.critical {
        background: #1E293B;
        border-color: #EF4444;
        color: #EF4444;
    }
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .metric-card {
        background: #1E293B;
        border: 1px solid #334155;
        border-radius: 8px;
        padding: 20px;
    }
    .alert-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #334155;
        margin-bottom: 10px;
    }
    .alert-item.healthy {
        background: #1E293B;
        border-left: 4px solid #10B981;
    }
    .alert-item.warning {
        background: #1E293B;
        border-left: 4px solid #F59E0B;
    }
    .alert-item.critical {
        background: #1E293B;
        border-left: 4px solid #EF4444;
    }
    .section-title {
        font-size: 18px;
        font-weight: 700;
        color: #F1F5F9;
        margin-top: 30px;
        margin-bottom: 15px;
        border-bottom: 2px solid #334155;
        padding-bottom: 10px;
    }
</style>
{% endblock %}

{% block content %}
<h1>ML Monitoring Dashboard</h1>
<p style="color: #94A3B8; font-size: 16px; margin-bottom: 30px;">Real-time monitoring of fraud detection model health and performance</p>

<!-- System Status Banner -->
<div class="status-banner status-{{ data.status.lower() }}">
    <div class="status-banner-title">
        {% if data.status == 'HEALTHY' %}
            <span class="status-banner-icon">‚úÖ</span>
        {% elif data.status == 'WARNING' %}
            <span class="status-banner-icon">‚ö†Ô∏è</span>
        {% else %}
            <span class="status-banner-icon">üö®</span>
        {% endif %}
        <span>System Status: {{ data.status }}</span>
    </div>
    <div class="status-banner-message">
        {% if data.status == 'HEALTHY' %}
            All monitoring systems operational. No alerts detected.
        {% elif data.status == 'WARNING' %}
            {{ data.active_alerts.total }} alert(s) detected. Review recommended.
        {% else %}
            {{ data.active_alerts.total }} critical alerts. Immediate action required.
        {% endif %}
    </div>
</div>

<!-- Key Metrics Grid -->
<div class="metrics-grid">
    <div class="metric-card">
        <div style="font-size: 13px; color: #94A3B8; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;">Total Predictions</div>
        <div style="font-size: 32px; font-weight: 700; color: #F1F5F9; margin-bottom: 5px;">{{ "{:,}".format(data.total_predictions_logged) }}</div>
        <div style="font-size: 12px; color: #94A3B8;">Logged in database</div>
    </div>

    <div class="metric-card">
        <div style="font-size: 13px; color: #94A3B8; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;">Last Prediction</div>
        <div style="font-size: 32px; font-weight: 700; color: #F1F5F9; margin-bottom: 5px;">
            {% if data.last_prediction %}
                {{ "%.1f" % (data.last_prediction.fraud_probability * 100) }}%
            {% else %}
                N/A
            {% endif %}
        </div>
        <div style="font-size: 12px; color: #94A3B8;">
            {% if data.last_prediction %}
                Entropy: {{ "%.3f" % data.last_prediction.prediction_entropy }}
            {% else %}
                No predictions yet
            {% endif %}
        </div>
    </div>

    <div class="metric-card">
        <div style="font-size: 13px; color: #94A3B8; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;">Active Alerts</div>
        <div style="font-size: 32px; font-weight: 700; {% if data.active_alerts.total > 2 %}color: #FCA5A5;{% elif data.active_alerts.total > 0 %}color: #FBBF24;{% else %}color: #34D399;{% endif %} margin-bottom: 5px;">{{ data.active_alerts.total }}</div>
        <div style="font-size: 12px; color: #94A3B8;">{{ data.active_alerts.confidence }} confidence, {{ data.active_alerts.behavior_shift }} behavior</div>
    </div>

    <div class="metric-card">
        <div style="font-size: 13px; color: #94A3B8; font-weight: 600; margin-bottom: 10px; text-transform: uppercase;">Model Version</div>
        <div style="font-size: 32px; font-weight: 700; color: #F1F5F9; margin-bottom: 5px;">{{ data.model.version }}</div>
        <div style="font-size: 12px; color: #94A3B8;">{{ data.model.name }}</div>
    </div>
</div>

<!-- Monitoring Coverage -->
<div class="section-title">Monitoring Coverage</div>
<div style="background: #1E293B; border: 1px solid #334155; border-left: 4px solid #3B82F6; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <div>
            <span style="font-weight: 600; color: #E2E8F0;">Data Drift:</span>
            <span style="{% if data.monitoring_coverage.data_drift %}color: #34D399;{% else %}color: #FCA5A5;{% endif %} margin-left: 10px;">
                {% if data.monitoring_coverage.data_drift %}&#10003; Enabled{% else %}&#10005; Disabled{% endif %}
            </span>
        </div>
        <div>
            <span style="font-weight: 600; color: #E2E8F0;">Silent Failure Detection:</span>
            <span style="{% if data.monitoring_coverage.silent_failure %}color: #34D399;{% else %}color: #FCA5A5;{% endif %} margin-left: 10px;">
                {% if data.monitoring_coverage.silent_failure %}&#10003; Enabled{% else %}&#10005; Disabled{% endif %}
            </span>
        </div>
        <div>
            <span style="font-weight: 600; color: #E2E8F0;">Background Monitoring:</span>
            <span style="{% if data.monitoring_coverage.background_monitoring %}color: #34D399;{% else %}color: #FCA5A5;{% endif %} margin-left: 10px;">
                {% if data.monitoring_coverage.background_monitoring %}&#10003; Enabled{% else %}&#10005; Disabled{% endif %}
            </span>
        </div>
    </div>
</div>

<!-- Alert Summary -->
<div class="section-title">Alert Summary</div>
<div>
    <div class="alert-item {% if data.active_alerts.data_drift > 0 %}critical{% else %}healthy{% endif %}">
        <div style="font-size: 24px;">
            {% if data.active_alerts.data_drift > 0 %}&#10005;{% else %}&#10003;{% endif %}
        </div>
        <div style="flex: 1;">
            <div style="font-weight: 600; color: #E2E8F0; margin-bottom: 4px;">
                Data Drift Alerts
                <span style="font-size: 11px; padding: 2px 8px; background: #334155; border-radius: 3px; margin-left: 8px; color: #94A3B8;">DRIFT</span>
            </div>
            <div style="font-size: 13px; color: #94A3B8;">{{ data.active_alerts.data_drift }} active drift alert(s)</div>
        </div>
    </div>

    <div class="alert-item {% if data.active_alerts.behavior_shift > 0 %}critical{% else %}healthy{% endif %}">
        <div style="font-size: 24px;">
            {% if data.active_alerts.behavior_shift > 0 %}&#10005;{% else %}&#10003;{% endif %}
        </div>
        <div style="flex: 1;">
            <div style="font-weight: 600; color: #E2E8F0; margin-bottom: 4px;">
                Behavior Shift Alerts
                <span style="font-size: 11px; padding: 2px 8px; background: #1E3A8A; border-radius: 3px; margin-left: 8px; color: #93C5FD;">BEHAVIOR</span>
            </div>
            <div style="font-size: 13px; color: #94A3B8;">{{ data.active_alerts.behavior_shift }} behavior anomaly alert(s)</div>
        </div>
    </div>

    <div class="alert-item {% if data.active_alerts.confidence > 0 %}warning{% else %}healthy{% endif %}">
        <div style="font-size: 24px;">
            {% if data.active_alerts.confidence > 0 %}&#9888;{% else %}&#10003;{% endif %}
        </div>
        <div style="flex: 1;">
            <div style="font-weight: 600; color: #E2E8F0; margin-bottom: 4px;">
                Confidence Alerts
                <span style="font-size: 11px; padding: 2px 8px; background: #831843; border-radius: 3px; margin-left: 8px; color: #F9A8D4;">CONFIDENCE</span>
            </div>
            <div style="font-size: 13px; color: #94A3B8;">{{ data.active_alerts.confidence }} confidence/entropy alert(s)</div>
        </div>
    </div>
</div>

<!-- Last Prediction Details -->
{% if data.last_prediction %}
<div class="section-title">Last Prediction Details</div>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
    <div style="background: #1E293B; border: 1px solid #334155; border-radius: 8px; padding: 15px; text-align: center;">
        <div style="font-size: 32px; {% if data.last_prediction.fraud_probability > 0.8 %}color: #FCA5A5;{% else %}color: #34D399;{% endif %} margin-bottom: 8px;">
            {% if data.last_prediction.fraud_probability > 0.8 %}&#9888;{% else %}&#10003;{% endif %}
        </div>
        <div style="font-size: 12px; color: #94A3B8; margin-bottom: 4px; font-weight: 600;">FRAUD PROBABILITY</div>
        <div style="font-size: 20px; font-weight: 700; color: #E2E8F0;">{{ "%.2f" % (data.last_prediction.fraud_probability * 100) }}%</div>
    </div>
    <div style="background: #1E293B; border: 1px solid #334155; border-radius: 8px; padding: 15px; text-align: center;">
        <div style="font-size: 32px; {% if data.last_prediction.prediction_entropy > 0.6 %}color: #FBBF24;{% else %}color: #34D399;{% endif %} margin-bottom: 8px;">
            {% if data.last_prediction.prediction_entropy > 0.6 %}&#9888;{% else %}&#10003;{% endif %}
        </div>
        <div style="font-size: 12px; color: #94A3B8; margin-bottom: 4px; font-weight: 600;">PREDICTION ENTROPY</div>
        <div style="font-size: 20px; font-weight: 700; color: #E2E8F0;">{{ "%.3f" % data.last_prediction.prediction_entropy }}</div>
    </div>
    <div style="background: #1E293B; border: 1px solid #334155; border-radius: 8px; padding: 15px; text-align: center;">
        <div style="font-size: 32px; color: #60A5FA; margin-bottom: 8px;">&#128337;</div>
        <div style="font-size: 12px; color: #94A3B8; margin-bottom: 4px; font-weight: 600;">TIMESTAMP</div>
        <div style="font-size: 14px; font-weight: 700; color: #E2E8F0;">{{ data.last_prediction.timestamp.split('T')[1][:8] if 'T' in data.last_prediction.timestamp else 'N/A' }}</div>
    </div>
    <div style="background: #1E293B; border: 1px solid #334155; border-radius: 8px; padding: 15px; text-align: center;">
        <div style="font-size: 32px; color: #34D399; margin-bottom: 8px;">&#10003;</div>
        <div style="font-size: 12px; color: #94A3B8; margin-bottom: 4px; font-weight: 600;">STATUS</div>
        <div style="font-size: 20px; font-weight: 700; color: #E2E8F0;">Logged</div>
    </div>
</div>
{% else %}
<div class="section-title">Last Prediction Details</div>
<div style="text-align: center; padding: 40px; background: #1E293B; border: 1px solid #334155; border-radius: 8px;">
    <div style="font-size: 48px; margin-bottom: 15px; color: #94A3B8;">&#9432;</div>
    <p style="color: #94A3B8;">No predictions logged yet. Make a prediction to see details.</p>
</div>
{% endif %}

{% endblock %}
